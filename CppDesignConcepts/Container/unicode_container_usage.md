# Unicode å­—å…ƒèˆ‡å®¹å™¨ä½¿ç”¨æŒ‡å—

## 1. æ ¸å¿ƒè¡“èªå®šç¾©

| è¡“èª                          | è‹±æ–‡                  | å®šç¾©                                       | ç¯„ä¾‹                     |
| :---------------------------- | :-------------------- | :----------------------------------------- | :----------------------- |
| **å­—å…ƒ (Character)**          | Character             | äººé¡å¯è®€çš„æœ€å°æ–‡å­—å–®ä½                     | `'A'`, `'ä¸­'`, `'ğŸ˜€'`    |
| **ç¢¼é» (Code Point)**         | Code Point            | Unicode åˆ†é…çµ¦å­—å…ƒçš„å”¯ä¸€ç·¨è™Ÿ               | U+4E2D (ä¸­), U+1F600 (ğŸ˜€) |
| **ç¢¼å…ƒ (Code Unit)**          | Code Unit             | ç·¨ç¢¼æ–¹æ¡ˆçš„åŸºæœ¬å„²å­˜å–®ä½                     | UTF-8: 1 byte, UTF-32: 4 bytes |
| **å­—ç¯€ (Byte)**               | Byte                  | 8 bitsï¼Œå¯¦éš›å„²å­˜å–®ä½                       | `0x41` (å­—æ¯ A)          |
| **å­—è© (Word/Token)**         | Word/Token            | å¤šå€‹å­—å…ƒçµ„æˆçš„èªç¾©å–®ä½                     | "apple", "ä¸­æ–‡"          |

---

## 2. ASCII èˆ‡ UTF ç·¨ç¢¼åŸºç¤

### 2.1 ç·¨ç¢¼æ–¹æ¡ˆæ¯”è¼ƒ

| ç·¨ç¢¼   | ç¢¼å…ƒå¤§å° | å­—å…ƒè¡¨ç¤º                      | ASCII | ä¸­æ–‡  | Emoji | å„ªç¼ºé»                         |
| :----- | :------- | :---------------------------- | :---- | :---- | :---- | :----------------------------- |
| UTF-32 | 4 bytes  | å›ºå®šé•·åº¦ï¼ˆ1 ç¢¼å…ƒ = 1 ç¢¼é»ï¼‰   | 4B    | 4B    | 4B    | âœ… ç›´æ¥ç´¢å¼• âŒ ç©ºé–“æµªè²»        |
| UTF-16 | 2 bytes  | å¯è®Šé•·åº¦ï¼ˆ1-2 ç¢¼å…ƒï¼‰          | 2B    | 2B    | 4B    | âš ï¸ BMP ç›´æ¥ï¼Œè£œå……å¹³é¢éœ€ä»£ç†å°  |
| UTF-8  | 1 byte   | å¯è®Šé•·åº¦ï¼ˆ1-4 ç¢¼å…ƒï¼‰          | 1B    | 3B    | 4B    | âœ… ç©ºé–“æ•ˆç‡é«˜ âŒ ç´¢å¼•éœ€è§£æ    |

```text
ç¯„ä¾‹ï¼š'ä¸­' (U+4E2D) çš„å„²å­˜
UTF-32: 00 00 4E 2D (4 bytes)
UTF-16: 4E 2D (2 bytes)
UTF-8:  E4 B8 AD (3 bytes)
```

### 2.2 C++ å­—å…ƒé¡å‹

```cpp
char        // 1 byte - å„²å­˜**å­—ç¯€**ï¼Œéå­—å…ƒï¼ˆå¸¸è¦‹èª¤è§£ï¼‰
char8_t     // 1 byte - C++20ï¼Œæ˜ç¢º UTF-8 ç¢¼å…ƒ
char16_t    // 2 bytes - UTF-16 ç¢¼å…ƒ
char32_t    // 4 bytes - UTF-32 ç¢¼å…ƒï¼Œç›´æ¥å°æ‡‰ Unicode ç¢¼é»
wchar_t     // å¹³å°ç›¸é—œ - **é¿å…ä½¿ç”¨**

// âœ… æ­£ç¢º
char32_t ch = U'ä¸­';    // 1 å€‹å®Œæ•´å­—å…ƒ

// âŒ éŒ¯èª¤
char c = 'ä¸­';          // ç·¨è­¯éŒ¯èª¤ï¼3 bytes ç„¡æ³•æ”¾å…¥ 1 byte
```

---

## 3. Container ä½¿ç”¨æ–¹å¼

### 3.1 `vector<char>` vs `vector<char32_t>`

| é¡å‹                    | å„²å­˜å–®ä½ | ç´¢å¼•æ„ç¾©      | é•·åº¦æ„ç¾©  | é©ç”¨å ´æ™¯           |
| :---------------------- | :------- | :------------ | :-------- | :----------------- |
| `vector<char>`          | å­—ç¯€     | ç¬¬ i å€‹å­—ç¯€   | å­—ç¯€æ•¸    | I/Oã€ç¶²è·¯ã€UTF-8   |
| `vector<char32_t>`      | å­—å…ƒ     | ç¬¬ i å€‹å­—å…ƒ   | å­—å…ƒæ•¸    | å­—å…ƒç´šæ“ä½œã€çµ±è¨ˆ   |

```cpp
// UTF-8 å­—ç¯€åºåˆ—
std::vector<char> utf8 = {'H', 'i', 0xE4, 0xB8, 0xAD};  // "Hiä¸­"
utf8.size();  // 5 (bytes)

// UTF-32 å­—å…ƒåºåˆ—
std::vector<char32_t> chars = {U'H', U'i', U'ä¸­'};
chars.size();  // 3 (characters)
chars[2];      // U'ä¸­' (ç¬¬ 3 å€‹å­—å…ƒ)
```

### 3.2 å­—å…ƒç´šå®¹å™¨ç¯„ä¾‹

```cpp
// å­—å…ƒé »ç‡çµ±è¨ˆ
std::unordered_map<char32_t, int> freq;
freq[U'ä¸­'] = 5;
freq[U'ğŸ˜€'] = 2;

// å­—å…ƒé›†åˆ
std::unordered_set<char32_t> allowed = {U'a', U'ä¸­', U'æ–‡'};
```

---

## 4. `std::string` é¡å‹èˆ‡ä½¿ç”¨

### 4.1 String é¡å‹å°æ‡‰

```cpp
std::string         // UTF-8 å­—ç¯€åºåˆ—ï¼ˆæœ€å¸¸ç”¨ï¼‰
std::u8string       // C++20 UTF-8 å°ˆç”¨
std::u16string      // UTF-16 å­—ä¸²
std::u32string      // UTF-32 å­—ä¸²ï¼ˆå­—å…ƒç´šæ“ä½œï¼‰
std::wstring        // å¹³å°ç›¸é—œï¼ˆé¿å…ï¼‰
```

### 4.2 `std::string` (UTF-8) é—œéµç†è§£

**æ ¸å¿ƒ**ï¼šå„²å­˜**å­—ç¯€åºåˆ—**ï¼Œéå­—å…ƒåºåˆ—

```cpp
std::string text = "ä½ å¥½";

// âœ… æ­£ç¢ºç†è§£
text.length();    // 6 (å­—ç¯€æ•¸ï¼Œéå­—å…ƒæ•¸)
text[0];          // 0xE4 (ç¬¬ 1 å€‹å­—ç¯€ï¼Œéå®Œæ•´å­—å…ƒ)

// âŒ éŒ¯èª¤ç†è§£
// text.length() â‰  å­—å…ƒæ•¸
// text[i] â‰  ç¬¬ i å€‹å­—å…ƒ
```

**å­—å…ƒç´šæ“ä½œéœ€ç¬¬ä¸‰æ–¹åº«**ï¼š

```cpp
// ä½¿ç”¨ utf8cpp
#include <utf8.h>
size_t num_chars = utf8::distance(text.begin(), text.end());  // 2 å­—å…ƒ
```

### 4.3 Container ä½¿ç”¨ç¯„ä¾‹

```cpp
// å­—è©å­˜å„²ï¼ˆUTF-8 å­—ä¸²ï¼‰
std::vector<std::string> words = {"apple", "ä¸­æ–‡", "ğŸ˜€"};
std::unordered_set<std::string> dict = {"cat", "dog"};
std::map<std::string, int> word_count = {{"hello", 5}};
```

---

## 5. `std::u32string` æ·±åº¦ä½¿ç”¨

### 5.1 æ ¸å¿ƒå„ªå‹¢

**å­—å…ƒç´šç›´æ¥å­˜å–**ï¼ˆ1 ç´¢å¼• = 1 å­—å…ƒï¼‰

```cpp
std::u32string text = U"Hello ä¸­æ–‡ ğŸ˜€";

text.length();    // 10 (å­—å…ƒæ•¸)
text[0];          // U'H' (ç¬¬ 1 å€‹å­—å…ƒ)
text[6];          // U'ä¸­' (ç¬¬ 7 å€‹å­—å…ƒ)
```

### 5.2 å­—å…ƒæ“ä½œ

```cpp
// å­—å…ƒçµ±è¨ˆ
std::unordered_map<char32_t, int> freq;
for (char32_t ch : text) { freq[ch]++; }

// å­—å…ƒæŸ¥æ‰¾
size_t pos = text.find(U'ä¸­');  // 6

// å­å­—ä¸²ï¼ˆå­—å…ƒç´šï¼‰
text.substr(6, 2);  // U"ä¸­æ–‡"
```

### 5.3 é™åˆ¶

```cpp
// âŒ ç„¡æ³•ç›´æ¥ I/O
std::ofstream file("out.txt");
// file << u32_text;  // ç·¨è­¯éŒ¯èª¤

// âŒ è¨˜æ†¶é«”ä½”ç”¨å¤§
std::string utf8 = "ä½ å¥½";      // 6 bytes
std::u32string utf32 = U"ä½ å¥½"; // 8 bytes (2 Ã— 4)

// âœ… éœ€è½‰æ›ç‚º UTF-8
std::string utf8 = convert_to_utf8(utf32);  // ä½¿ç”¨åº«
```

---

## 6. é—œéµå­˜å–æ–¹å¼ç¸½çµ

### 6.1 å­—å…ƒ vs å­—ç¯€å­˜å–

| é¡å‹                    | å­˜å–å–®ä½ | ç´¢å¼•                   | é•·åº¦          |
| :---------------------- | :------- | :--------------------- | :------------ |
| `std::u32string`        | å­—å…ƒ     | `[i]` = ç¬¬ i å€‹å­—å…ƒ    | å­—å…ƒæ•¸        |
| `std::vector<char32_t>` | å­—å…ƒ     | `[i]` = ç¬¬ i å€‹å­—å…ƒ    | å­—å…ƒæ•¸        |
| `std::string` (UTF-8)   | å­—ç¯€     | `[i]` = ç¬¬ i å€‹å­—ç¯€    | å­—ç¯€æ•¸        |
| `std::vector<char>`     | å­—ç¯€     | `[i]` = ç¬¬ i å€‹å­—ç¯€    | å­—ç¯€æ•¸        |

### 6.2 è¿­ä»£å·®ç•°

```cpp
// UTF-8: è¿­ä»£å­—ç¯€
std::string utf8 = "Hiä¸­";
for (char byte : utf8) { }  // 5 æ¬¡è¿­ä»£ (5 bytes)

// UTF-32: è¿­ä»£å­—å…ƒ
std::u32string utf32 = U"Hiä¸­";
for (char32_t ch : utf32) { }  // 3 æ¬¡è¿­ä»£ (3 å­—å…ƒ)
```

### 6.3 å­—è© (Word) å­˜å–

**å­—è© â‰  å­—å…ƒ**ï¼Œå­—è©æ˜¯å¤šå€‹å­—å…ƒçµ„æˆ

```cpp
std::vector<std::string> words = {"apple", "ä¸­æ–‡"};
words[1];  // "ä¸­æ–‡" (æ•´å€‹å­—è©)
words[1].size();  // 6 bytes (éå­—å…ƒæ•¸)
```

---

## 7. å¯¦å‹™é¸æ“‡æŒ‡å—

| å ´æ™¯                   | æ¨è–¦æ–¹æ¡ˆ                        | ç†ç”±                   |
| :--------------------- | :------------------------------ | :--------------------- |
| å­—å…ƒé »ç‡çµ±è¨ˆ           | `unordered_map<char32_t, int>`  | å­—å…ƒç´šæ“ä½œ             |
| å–®è©/è©å½™å­˜å„²          | `unordered_set<string>` (UTF-8) | è™•ç†è©éå­—å…ƒï¼Œç¯€çœç©ºé–“ |
| éœ€ç´¢å¼•ç¬¬ n å€‹å­—å…ƒ      | `u32string` / `vector<char32_t>` | å›ºå®šå¤§å°ç›´æ¥ç´¢å¼•       |
| æ–‡ä»¶ I/O / ç¶²è·¯å‚³è¼¸    | `string` (UTF-8)                | æ¨™æº–æ ¼å¼ï¼Œç©ºé–“æ•ˆç‡é«˜   |
| å­—å…ƒç´šç®—æ³•ï¼ˆæ’åºï¼‰     | `u32string` / `vector<char32_t>` | æ¯å€‹å…ƒç´ æ˜¯å®Œæ•´å­—å…ƒ     |

**æ€§èƒ½æ¬Šè¡¡**ï¼š

```cpp
// "ä½ å¥½ä¸–ç•Œ" (4 å­—å…ƒ)
std::string utf8 = "ä½ å¥½ä¸–ç•Œ";      // 12 bytes, O(n) ç´¢å¼•å­—å…ƒ
std::u32string utf32 = U"ä½ å¥½ä¸–ç•Œ"; // 16 bytes, O(1) ç´¢å¼•å­—å…ƒ
```

---

## 8. å¸¸è¦‹é™·é˜±

### é™·é˜± 1ï¼šæ··æ·†å­—ç¯€èˆ‡å­—å…ƒ

```cpp
// âŒ éŒ¯èª¤
std::string text = "ä½ å¥½";
if (text.length() == 2) { }  // false! (6 bytes)

// âœ… æ­£ç¢º
std::u32string text = U"ä½ å¥½";
if (text.length() == 2) { }  // true! (2 å­—å…ƒ)
```

### é™·é˜± 2ï¼šç”¨ `char` å­˜ Unicode

```cpp
// âŒ ç·¨è­¯éŒ¯èª¤
char c = 'ä¸­';

// âœ… æ­£ç¢º
char32_t c = U'ä¸­';
```

### é™·é˜± 3ï¼šå‡è¨­ç´¢å¼•è¿”å›å­—å…ƒ

```cpp
std::string utf8 = "ä¸­æ–‡";
utf8[0];  // 0xE4 (ç¬¬ 1 å€‹å­—ç¯€ï¼Œé 'ä¸­')

std::u32string utf32 = U"ä¸­æ–‡";
utf32[0];  // U'ä¸­' (ç¬¬ 1 å€‹å­—å…ƒ)
```

### é™·é˜± 4ï¼šå¹³å°ç›¸é—œ `wchar_t`

```cpp
// âŒ é¿å…
std::wstring ws = L"text";  // Windows: 2B, Linux: 4B

// âœ… æ˜ç¢º
std::u32string u32 = U"text";  // æ˜ç¢º 4 bytes
```

---

## 9. ç·¨ç¢¼è½‰æ›

### æ¨™æº–åº«ï¼ˆå·²æ£„ç”¨ï¼‰

```cpp
// âš ï¸ C++17 å·²æ£„ç”¨ï¼Œä¸å»ºè­°ä½¿ç”¨
#include <codecvt>
```

### æ¨è–¦ç¬¬ä¸‰æ–¹åº«

```cpp
// 1. utf8cpp (header-only)
#include <utf8.h>
std::u32string utf32;
utf8::utf8to32(utf8_str.begin(), utf8_str.end(), back_inserter(utf32));

// 2. ICU - åŠŸèƒ½æœ€å®Œæ•´
// 3. Boost.Locale
#include <boost/locale.hpp>
auto utf32 = boost::locale::conv::utf_to_utf<char32_t>(utf8_str);
```

---

## 10. å¿«é€Ÿæ±ºç­–

### æ±ºç­–æ¨¹

```text
éœ€è¦è™•ç† Unicodeï¼Ÿ
â”œâ”€ æ˜¯ â†’ æ“ä½œå–®ä½æ˜¯ï¼Ÿ
â”‚   â”œâ”€ å­—å…ƒ â†’ char32_t / u32string
â”‚   â””â”€ å­—è© â†’ string (UTF-8)
â””â”€ å¦ (åƒ… ASCII) â†’ char / string
```

### æ ¸å¿ƒåŸå‰‡

1. **è™•ç†å­—å…ƒ**ï¼Ÿâ†’ `char32_t` / `u32string`
2. **è™•ç†å­—è©/æ–‡æœ¬**ï¼Ÿâ†’ `string` (UTF-8)
3. **éœ€å­—å…ƒç´šç´¢å¼•**ï¼Ÿâ†’ `u32string`
4. **éœ€ I/O / ç¶²è·¯**ï¼Ÿâ†’ `string` (UTF-8)
5. **é¿å…**ï¼š`char` å­˜ Unicodeã€`wchar_t`

### å®Œæ•´ç¯„ä¾‹

```cpp
// å­—å…ƒé »ç‡çµ±è¨ˆ
std::u32string text = U"Hello ä¸–ç•Œ ğŸ˜€ğŸ˜€";
std::unordered_map<char32_t, int> freq;
for (char32_t ch : text) {
    if (ch != U' ') freq[ch]++;
}

// è©å½™è¡¨å»é‡
std::vector<std::string> words = {"apple", "apple", "ä¸­æ–‡", "ä¸­æ–‡"};
std::unordered_set<std::string> unique(words.begin(), words.end());
```
